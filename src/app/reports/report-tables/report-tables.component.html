<div *ngIf="!reportData">
  <i class="fas fa-spinner fa-pulse"></i>
</div>
<div *ngIf="reportData" id="tables-body">
  <div class="flex-container">
    <table cellspacing="0" id="projectionsTable">
      <tr>
        <th>Map</th>
        <th></th>
        <th>Projected</th>
        <th>Sales</th>
        <th>Total</th>
        <th colspan="2">Year 1</th>
        <th colspan="2">Year 2</th>
        <th colspan="2">Year 3</th>
        <th colspan="2">Year 1</th>
        <th>$/sqft from</th>
        <th></th>
      </tr>
      <tr>
        <th>Key</th>
        <th>Scenario</th>
        <th>FIT Image</th>
        <th>Area</th>
        <th>Area</th>
        <th>Ending</th>
        <th>$/sqft</th>
        <th>Ending</th>
        <th>$/sqft</th>
        <th>Ending</th>
        <th>$/sqft</th>
        <th>Annualized</th>
        <th>$/sqft</th>
        <th>Total Area</th>
        <th>Comment</th>
      </tr>
      <tr>
        <td>{{reportData.projections.mapKey}}</td>
        <td>{{reportData.projections.storeName}}</td>
        <td>{{reportData.projections.effectivePower | number:'1.0-0'}}</td>
        <td>{{reportData.projections.salesArea | number}}</td>
        <td>{{reportData.projections.totalArea | number}}</td>
        <td>{{reportData.projections.firstYearEndingSales | thousandsCurrency}}</td>
        <td>{{reportData.projections.firstYearEndingSalesPSF | currency}}</td>
        <td>{{reportData.projections.secondYearEndingSales | thousandsCurrency}}</td>
        <td>{{reportData.projections.secondYearEndingSalesPSF | currency}}</td>
        <td>{{reportData.projections.thirdYearEndingSales | thousandsCurrency}}</td>
        <td>{{reportData.projections.thirdYearEndingSalesPSF | currency}}</td>
        <td>{{reportData.projections.firstYearEndingSales * 52 | thousandsCurrency}}</td>
        <td>{{reportData.projections.firstYearEndingSales * 52 / reportData.projections.salesArea | currency}}</td>
        <td>{{reportData.projections.firstYearEndingSales * 52 / reportData.projections.totalArea | currency}}</td>
        <td>{{reportData.projections.comment}}</td>
      </tr>
    </table>
  </div>
  <hr/>
  <div class="flex-container">
    <table class="force10" cellspacing="0" id="currentStoresWeeklySummaryTable">
      <tr>
        <th colspan="8">
          <h2>Current Stores Weekly Summary - {{reportData.currentSummary.date | date:'MMM yyyy'}}</h2>
        </th>
      </tr>
      <tr>
        <th>Map Key</th>
        <th>Store Name</th>
        <th>Location</th>
        <th>Volume</th>
        <th>$/sqft</th>
        <th>Sales Area</th>
        <th>PWTA</th>
        <th>FIT Power</th>
      </tr>
      <tr *ngFor="let store of reportData.currentSummary.stores">
        <td>{{store.mapKey}}</td>
        <td>{{store.storeName}}</td>
        <td>{{store.location}}</td>
        <td class="right-align">${{store.volume | number:'1.0-2'}}</td>
        <td class="right-align">${{store.psf | number:'1.2-2'}}</td>
        <td class="right-align">{{store.salesArea | number:'1.0-0'}}</td>
        <td class="right-align">{{store.pwta | number:'1.0-0'}}</td>
        <td class="right-align">{{store.fitPower | number:'1.0-0'}}</td>
      </tr>
      <tr class="bold summary">
        <td>Average</td>
        <td></td>
        <td></td>
        <td class="right-align">${{reportData.currentSummary.summary.volume | number:'1.0-0'}}</td>
        <td class="right-align">${{reportData.currentSummary.summary.psf | number:'1.2-2'}}</td>
        <td class="right-align">{{reportData.currentSummary.summary.salesArea | number:'1.0-0'}}</td>
        <td></td>
        <td class="right-align">{{reportData.currentSummary.summary.power | number:'1.0-0'}}</td>
      </tr>
      <tr *ngIf="reportData.currentSummary.overflowCount > 0">
        <td colspan="8" class="footnote">
          Excluding {{reportData.currentSummary.overflowCount}} stores with minimal contribution
        </td>
      </tr>
    </table>
  </div>
  <hr/>
  <div class='flex-container'>
    <table class="force10" cellspacing="0" id="projectedStoresWeeklySummaryTable">
      <tr>
        <th colspan="8">
          <h2>Projected Stores Weekly Summary - {{reportData.projectedSummary.date | date:'MMM yyyy'}}</h2>
        </th>
      </tr>
      <tr>
        <th>Map Key</th>
        <th>Store Name</th>
        <th>Location</th>
        <th>Volume</th>
        <th>$/sqft</th>
        <th>Sales Area</th>
        <th>PWTA</th>
        <th>FIT Power</th>
      </tr>
      <tr *ngFor="let store of reportData.projectedSummary.stores"
          [ngClass]="store.isSite ? 'red-highlight' : store.category === 'Proposed Competition' ? 'bold' : ''">
        <td>{{store.mapKey}}</td>
        <td>{{store.storeName}}</td>
        <td>{{store.location}}</td>
        <td class="right-align">${{store.volume | number:'1.0-2'}}</td>
        <td class="right-align">${{store.psf | number:'1.0-2'}}</td>
        <td class="right-align">{{store.salesArea | number:'1.0-0'}}</td>
        <td class="right-align">{{store.pwta | number:'1.0-0'}}</td>
        <td class="right-align">{{store.fitPower | number:'1.0-0'}}</td>
      </tr>
      <tr class="bold summary white-row">
        <td>Average</td>
        <td></td>
        <td></td>
        <td class="right-align">${{reportData.projectedSummary.summary.volume | number:'1.0-0'}}</td>
        <td class="right-align">${{reportData.projectedSummary.summary.psf | number:'1.2-2'}}</td>
        <td class="right-align">{{reportData.projectedSummary.summary.salesArea | number:'1.0-0'}}</td>
        <td></td>
        <td class="right-align">{{reportData.projectedSummary.summary.power | number:'1.0-0'}}</td>
      </tr>
      <tr *ngIf="reportData.projectedSummary.overflowCount > 0">
        <td colspan="8" class="footnote">
          Excluding {{reportData.projectedSummary.overflowCount}} stores with minimal contribution
        </td>
      </tr>
    </table>
  </div>
  <hr>
  <div class="flex-container">
    <table cellspacing="0" id="sourceOfVolumeTable">
      <tr>
        <th colspan="12" style="padding: 10px;">
          <div style="display: flex; width: 100%; justify-content: space-between; font-size: xx-large;">
            <span>Source of Volume</span>
            <span>{{util.targetStore.storeName}}</span>
          </div>
        </th>
      </tr>
      <tr>
        <th></th>
        <th></th>
        <th></th>
        <th>FIT</th>
        <th>Straight</th>
        <th colspan="2">Size (sqft)*</th>
        <th>Sales</th>
        <th colspan="4">{{reportData.sovData.firstYearEndDate | date: 'MMM yyyy'}} Volume</th>
      </tr>
      <tr>
        <th>Primary Sources of</th>
        <th>Address or</th>
        <th>Map</th>
        <th>Store</th>
        <th>Line Dist.</th>
        <th>Sales</th>
        <th>Est. Total</th>
        <th>as of</th>
        <th>+Pop Grwth, Infl.</th>
        <th colspan="2">Contribution</th>
        <th>Resulting</th>
      </tr>
      <tr>
        <th>Projected Volume</th>
        <th>Intersection</th>
        <th>Key</th>
        <th>Power</th>
        <th>From Site</th>
        <th>Area</th>
        <th>Area</th>
        <th>{{reportData.sovData.fieldResDate | date:'MMM yyyy'}}</th>
        <th>& Comp. Chngs.</th>
        <th colspan="2">to Site</th>
        <th>Volume</th>
      </tr>
      <tr class="blue">
        <td class="table-section-header">
          Company Stores
        </td>
        <td colspan="11"></td>
      </tr>
      <tr *ngFor="let store of reportData.sovData.companyStores" [class]="store.isSite ? 'bold blue': 'blue'">
        <td>{{store.storeName}}</td>
        <td nowrap>{{store.address}}</td>
        <td class="right-align">{{store.mapKey}}</td>
        <td class="right-align">{{store.power | number:'1.0-0'}}</td>
        <td class="right-align" *ngIf="store.isSite">-</td>
        <td class="right-align" *ngIf="!store.isSite">{{store.distance | number:'1.2-2'}} mi.</td>
        <td class="right-align">{{store.salesArea | number:'1.0-0'}}</td>
        <td class="right-align">{{store.totalArea | number:'1.0-0'}}</td>
        <td class="right-align" *ngIf="store.isSite">-</td>
        <td class="right-align" *ngIf="!store.isSite">{{store.actualSales / 1000 | number:'1.0-2'}}</td>
        <td class="right-align" *ngIf="store.isSite">-</td>
        <td class="right-align" *ngIf="!store.isSite">{{store.futureSales / 1000 | number:'1.0-0'}}</td>
        <td class="right-align">{{store.contributionDollars ? (store.contributionDollars / 1000).toFixed(0) : '-'}}</td>
        <td class="right-align" *ngIf="store.isSite">-</td>
        <td class="right-align" *ngIf="!store.isSite">{{store.contributionPercent | number:'1.1-1'}}%</td>
        <td class="right-align" *ngIf="store.closing">-</td>
        <td class="right-align" *ngIf="!store.closing">{{store.resultingVolume / 1000 | number:'1.0-0'}}</td>
      </tr>
      <tr *ngIf="reportData.sovData.companyStores.length > 1" class="blue">
        <td></td>
        <td colspan="2" class="right-align"><b>Average Power</b></td>
        <td class="right-align" style="border-top:1px solid black;">
          <b>{{reportData.sovData.companyStoresSummary.fitAverage | number:'1.0-0'}}</b>
        </td>
        <td colspan="5" class="right-align"><b>Subtotal</b></td>
        <td class="right-align" style="border-top:1px solid black;">
          <b>${{reportData.sovData.companyStoresSummary.contributionSum / 1000 | number:'1.0-0'}}</b>
        </td>
        <td colspan="2"></td>
      </tr>
      <tr *ngIf="reportData.sovData.existingCompetition.length > 0" class="yellow">
        <td class="table-section-header">Existing Competition</td>
        <td colspan="11"></td>
      </tr>
      <tr *ngFor="let store of reportData.sovData.existingCompetition" class="yellow">
        <td>{{store.storeName}}</td>
        <td nowrap>{{store.address}}</td>
        <td class="right-align">{{store.mapKey}}</td>
        <td class="right-align">{{store.power | number:'1.0-0'}}</td>
        <td class="right-align">{{store.distance | number:'1.2-2'}} mi.</td>
        <td class="right-align">{{store.salesArea | number:'1.0-0'}}</td>
        <td class="right-align">{{store.totalArea | number:'1.0-0'}}</td>
        <td class="right-align">{{store.currentSales / 1000 | number:'1.0-0'}}</td>
        <td class="right-align">{{store.futureSales / 1000 | number:'1.0-0'}}</td>
        <td class="right-align">{{store.contributionDollars / 1000 | number:'1.0-0'}}</td>
        <td class="right-align">{{store.contributionPercent | number:'1.1-1'}}%</td>
        <td class="right-align" *ngIf="!store.closing">{{store.resultingVolume / 1000 | number:'1.0-0'}}</td>
        <td class="right-align" *ngIf="store.closing">-</td>
      </tr>
      <tr *ngIf="reportData.sovData.existingCompetition.length > 1" class="yellow">
        <td></td>
        <td colspan="2" class="right-align"><b>Average Power</b></td>
        <td class="right-align" style="border-top:1px solid black;">
          <b>{{reportData.sovData.existingCompetitionSummary.fitAverage | number:'1.0-0'}}</b>
        </td>
        <td colspan="5" class="right-align"><b>Subtotal</b></td>
        <td class="right-align" style="border-top:1px solid black;">
          <b>${{reportData.sovData.existingCompetitionSummary.contributionSum / 1000 | number:'1.0-0'}}</b>
        </td>
        <td colspan="2"></td>
      </tr>
      <tr *ngIf="reportData.sovData.proposedCompetition.length > 0" class="pink">
        <td class="table-section-header">Proposed Competition</td>
        <td colspan="11"></td>
      </tr>
      <tr *ngFor="let store of reportData.sovData.proposedCompetition" class="pink">
        <td>{{store.storeName}}</td>
        <td nowrap>{{store.address}}</td>
        <td class="right-align">{{store.mapKey}}</td>
        <td class="right-align">{{store.power | number:'1.0-0'}}</td>
        <td class="right-align">{{store.distance | number:'1.2-2'}} mi.</td>
        <td class="right-align">{{store.salesArea | number:'1.0-0'}}</td>
        <td class="right-align">{{store.totalArea | number:'1.0-0'}}</td>
        <td class="right-align">{{store.currentSales / 1000 | number:'1.0-0'}}</td>
        <td class="right-align">{{store.futureSales / 1000 | number:'1.0-0'}}</td>
        <td class="right-align">{{store.contributionDollars / 1000 | number:'1.0-0'}}</td>
        <td class="right-align">{{store.contributionPercent | number:'1.1-1'}}%</td>
        <td class="right-align" *ngIf="!store.closing">{{store.resultingVolume / 1000 | number:'1.0-0'}}</td>
        <td class="right-align" *ngIf="store.closing">-</td>
      </tr>
      <tr *ngIf="reportData.sovData.proposedCompetition.length > 1" class="pink">
        <td></td>
        <td colspan="2" class="right-align"><b>Average Power</b></td>
        <td class="right-align" style="border-top:1px solid black;">
          <b>{{reportData.sovData.proposedCompetitionSummary.fitAverage | number:'1.0-0'}}</b>
        </td>
        <td colspan="5" class="right-align"><b>Subtotal</b></td>
        <td class="right-align" style="border-top:1px solid black;">
          <b>${{reportData.sovData.proposedCompetitionSummary.contributionSum / 1000 | number:'1.0-0'}}</b>
        </td>
        <td colspan="2"></td>
      </tr>
      <tr>
        <td colspan="5"><b>Sales Potential (Assume Store Opens {{reportData.sovData.openingDate | date: 'MMM yyyy'}})</b></td>
        <td colspan="4"><b>Sales Transfers from Company Stores</b></td>
        <td class="right-align">${{reportData.sovData.salesTransferFromCompanyStores / 1000 | number:'1.0-0'}}</td>
        <td colspan="2"></td>
      </tr>
      <tr>
        <td><b>{{reportData.sovData.firstYearEndDate | date: 'MMM yyyy'}} - After Open 1 Year</b></td>
        <td><b>${{util.targetStore['resultingVolume'] / 1000 | number:'1.0-0'}}</b></td>
        <td colspan="3"></td>
        <td colspan="4"><b>Sales Transfers from Competition</b></td>
        <td class="right-align">${{reportData.sovData.salesTransferFromCompetition / 1000 | number:'1.0-0'}}</td>
        <td colspan="2"></td>
      </tr>
      <tr>
        <td class="footnote">*Area devoted to food group</td>
        <td class="footnote" colspan="4">Note: Sales effects based on gravity model analysis.</td>
        <td colspan="4"><b>Total Sales Transfer</b></td>
        <td class="right-align">${{reportData.sovData.totalSalesTransfer / 1000 | number:'1.0-0'}}</td>
        <td colspan="2"></td>
      </tr>
      <tr>
        <td *ngIf="reportData.sovData.showingCount < reportData.sovData.totalCount" class="footnote" colspan="5">
          {{getOverflowMessage()}}
        </td>
        <td *ngIf="reportData.sovData.showingCount >= reportData.sovData.totalCount" colspan="5"></td>
        <td colspan="4"><b>Percent of Sales Explained After One Year</b></td>
        <td class="right-align">{{reportData.sovData.percentOfSalesExplainedAfterOneYear | number:'1.1-1'}}%</td>
        <td colspan="2"></td>
      </tr>
    </table>
  </div>
  <hr>
  <div class="flex-container">
    <table style="max-width: 2.5in;" cellspacing="0" id="descriptionsRatings">
      <tr>
        <th class="table-section-header" colspan="2">
          Site Evaluation
        </th>
      </tr>
      <tr>
        <td class="bold" colspan="2" style="text-align:left;">Access</td>
      </tr>
      <tr>
        <td>North</td>
        <td>{{reportData.ratings.accessNorth}}</td>
      </tr>
      <tr>
        <td>South</td>
        <td>{{reportData.ratings.accessSouth}}</td>
      </tr>
      <tr>
        <td>East</td>
        <td>{{reportData.ratings.accessEast}}</td>
      </tr>
      <tr>
        <td>West</td>
        <td>{{reportData.ratings.accessWest}}</td>
      </tr>
      <tr>
        <td class="bold" style="text-align:left;">Ingress/Egress</td>
        <td>{{reportData.ratings.ingressEgress}}</td>
      </tr>
      <tr>
        <td class="bold" colspan="2" style="text-align:left;">Visibility</td>
      </tr>
      <tr>
        <td>North</td>
        <td>{{reportData.ratings.visibilityNorth}}</td>
      </tr>
      <tr>
        <td>South</td>
        <td>{{reportData.ratings.visibilitySouth}}</td>
      </tr>
      <tr>
        <td>East</td>
        <td>{{reportData.ratings.visibilityEast}}</td>
      </tr>
      <tr>
        <td>West</td>
        <td>{{reportData.ratings.visibilityWest}}</td>
      </tr>
      <tr>
        <td class="bold" colspan="2" style="text-align:left;">Population Density</td>
      </tr>
      <tr>
        <td>North</td>
        <td>{{reportData.ratings.populationDensityNorth}}</td>
      </tr>
      <tr>
        <td>South</td>
        <td>{{reportData.ratings.populationDensitySouth}}</td>
      </tr>
      <tr>
        <td>East</td>
        <td>{{reportData.ratings.populationDensityEast}}</td>
      </tr>
      <tr>
        <td>West</td>
        <td>{{reportData.ratings.populationDensityWest}}</td>
      </tr>
    </table>
  </div>
  <hr>
  <div *ngIf="util" style="display: flex; align-items: center; justify-content: center;">
    <img [src]="util.getMapUrl(googleMapsBasemap, zoom)" id="mapImage">
    <div>
      <button [color]="googleMapsBasemap === 'hybrid' ? 'warn':'primary'"
              (click)="googleMapsBasemap = 'hybrid'"
              mat-raised-button style="margin:5px;">Sat
      </button>
      <br>
      <button [color]="googleMapsBasemap === 'roadmap' ? 'warn':'primary'"
              (click)="googleMapsBasemap = 'roadmap'"
              mat-raised-button style="margin:5px;">Road
      </button>
      <br>
      <button color="primary" (click)="adjustZoom(1)" mat-raised-button style="margin:5px;"><i
        class="fas fa-search-plus"></i></button>
      <br>
      <button color="primary" (click)="adjustZoom(-1)" mat-raised-button style="margin:5px;"><i
        class="fas fa-search-minus"></i></button>
      <br>
    </div>
  </div>
  <hr>
  <div>
    <button color="primary" mat-raised-button (click)="_location.back()" style="margin:20px 20px 0 0;">Go Back</button>
    <button [disabled]="rbs.complingReport" color="warn" mat-raised-button (click)="startBuildingReport()"
            style="margin-top:20px;">
      Export
    </button>
    <span class="file-tip" *ngIf="rbs.complingReport">
        <i class="fas fa-spinner fa-pulse" style="margin-right:5px;"></i>
        <b>Compiling Report. This may take a couple minutes...</b>
    </span>
  </div>
</div>
