<div class='main-wrapper'>
  <div class='left-panel'>
    <h2 *ngIf="records.length">{{currentRecordIndex + 1 }}/{{records.length}}</h2>
    <mat-list *ngIf="records.length">
      <mat-list-item *ngFor="let record of records; let i = index" [id]="i" [ngClass]="{highlighted: i === currentRecordIndex, validated: record.validated}"
        (click)="setCurrentSpreadsheetRecord(i)">
        <div>
          <span class='list-item-header'>{{record.displayName}}</span>
          <br>
          <span class="list-item-desc">{{record.coordinates.lat}}, {{record.coordinates.lng}}</span>
        </div>
      </mat-list-item>
    </mat-list>
  </div>
  <div *ngIf="!records.length" class="informative">
    <p>Upload a file to begin matching to the database</p>
  </div>
  <div *ngIf="records.length" class="center-panel hidden-sm">
    <mds-map #map class="row content" (ready)="onMapReady($event)"></mds-map>
  </div>
  <div *ngIf="records.length" class="right-panel">
    <div class='loader' *ngIf="isFetching">
      <div>
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        <br>
        <div class='large-text'>
          Fetching Data
        </div>
      </div>
    </div>
    <mat-horizontal-stepper [linear]='true' #stepper style="padding-bottom: 50px;">
      <ng-template matStepperIcon="edit">
        <i class="fas fa-pencil-alt"></i>
      </ng-template>
      <ng-template matStepperIcon="done">
        <i class="fas fa-check"></i>
      </ng-template>
      <mat-step editable="false">
        <ng-template matStepLabel>Match Site</ng-template>
        <!-- CONTENT FOR FIRST SECTION! -->
        <div class='flex-container' *ngIf="currentRecord">
            <div>
              <div class='large-text'>
                  {{currentRecord.displayName}}
              </div>
              <div class='med-text'>Update Fields
              </div>
              <div class='small-text' [innerHTML]="updateFieldsSummary()">
              </div>
            </div>
            <button (click)="addSite()" mat-button class=''>Add Site
            </button>
          </div>
        <div>
        </div>
        <div class='accent-bar large-text'>Match to Existing</div>
        <div class='results-table'>
          <div class='loader' *ngIf="gettingEntities">
            <div>
              <mat-progress-bar mode="indeterminate"></mat-progress-bar>
              <br>
              <div class='large-text'>
                Fetching Stores From MTNRA Database
              </div>
            </div>
          </div>
          <div [ngClass]="i % 2 != 0 ? 'results-item secondary-row':'results-item'" *ngFor="let site of currentDBSiteResults; let i=index;">
            <div class="results-header large-text flex-container">
              <!-- <i mat-icon-button [mat-menu-trigger-for]="siteMenu" class="site-menu fas fa-ellipsis-v"></i>
              <mat-menu #siteMenu="matMenu">
                <button (click)="matchShoppingCenter(site.shoppingCenterId);" mat-menu-item>Add Sister Shopping
                  Center
                  Site
                </button>
              </mat-menu> -->
              <div *ngIf="site.distanceFrom" [style.color]="site.distanceFrom < 0.5 ? 'green': '#ff9802'" class='site-distance'>
                <i class="fas fa-arrow-circle-up" [style.transform]="site.heading"></i>
                {{site.distanceFrom.toFixed(2)}}
                Miles
              </div>
              <div class='site-title'>{{site.address1 + ", " + site.city + ", " + site.state }}</div>
              <button (click)="matchSite(site.id)" mat-button class=' add-store'>
                Add Store
              </button>
            </div>
            <mat-divider></mat-divider>
            <div (mouseenter)="siteHover(store, 'enter')" (mouseleave)="siteHover(store, 'leave')" class="results-each"
              *ngFor="let store of site.stores">
              <div class="flex-container">
                <div class='store-attribute'>{{store.storeName}}</div>
                <div class='hidden-xs store-attribute'>{{store.storeType}}</div>
                <div class='hidden-xs store-attribute'>{{store.currentStoreStatus}}</div>
                <button (click)="matchStore(store.id)" mat-button matStepperNext [ngClass]="{'highlighted': bestMatch && bestMatch.store.id == store.id && bestMatch.score <=4}">
                  Match
                </button>
              </div>
            </div>
          </div>
        </div>
      </mat-step>

      <mat-step>
        <ng-template matStepLabel>Match/Edit Data</ng-template>
        <mds-spreadsheet-data-form *ngIf="logic && openForm" [logic]="logic" [dbRecord]="dbRecord"
                          [currentRecord]="currentRecord"
                          [updatedGeom]="updatedGeom"
                          (cancelEvent)="cancelStep2()"
                          (completedEvent)="nextRecord()">
        </mds-spreadsheet-data-form>
      </mat-step>
    </mat-horizontal-stepper>
  </div>
</div>
