<mat-sidenav-container id="casing-dash-container">
  <mat-sidenav mode="over" [(opened)]="filterSideNavIsOpen" class="casing-side-nav" position="end"
               (closedStart)="filterClosed()">
    <mat-list role="list" id="filter-side-nav">
      <h3 mat-subheader>Store Type</h3>
      <div class="checklist">
        <mat-checkbox [(ngModel)]="casingDashboardService.filter.active">Active</mat-checkbox>
        <mat-checkbox [(ngModel)]="casingDashboardService.filter.future">Future</mat-checkbox>
        <mat-checkbox [(ngModel)]="casingDashboardService.filter.historical">Historical</mat-checkbox>
      </div>
    </mat-list>
  </mat-sidenav>
  <mat-sidenav-content>
    <div class="box">
      <mds-map #casingMap class="row content" (ready)="onMapReady()"></mds-map>
      <div class="infoCardContainer">
        <div class="infoCard" *ngIf="selectedCardState === cardState.GOOGLE && selectedGooglePlace">
          <mat-card>
            <mat-card-header>
              <mat-card-title>
                <strong>{{selectedGooglePlace.name}}</strong>
              </mat-card-title>
              <mat-card-subtitle><em>(Provided by Google)</em></mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              {{selectedGooglePlace.vicinity}}
            </mat-card-content>
            <mat-card-actions>
              <button mat-button [disabled]="true || selectedDashboardMode === casingDashboardMode.MOVING_MAPPABLE"
                      (click)="saveGooglePlaceAsStore()">
                <i class="fas fa-save"></i>&nbsp;Save To DB
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
        <mds-store-info-card class="infoCard" [store]="selectedStore"
                             [disableActions]="selectedDashboardMode !== casingDashboardMode.DEFAULT"
                             (onUpdate)="onStoreUpdated($event)"
                             (initiateMove)="moveStore($event)"
                             (initiateDuplicateSelection)="initiateDuplicateSelection($event.id)"
                             *ngIf="selectedCardState === cardState.SELECTED_STORE && selectedStore != null"></mds-store-info-card>
        <mds-site-info-card class="infoCard" [site]="selectedSite"
                            [disableActions]="selectedDashboardMode !== casingDashboardMode.DEFAULT"
                            (onUpdate)="onSiteUpdated($event)"
                            (initiateMove)="moveSite($event)"
                            (initiateDuplicateSelection)="initiateDuplicateSelection($event.id)"
                            *ngIf="selectedCardState === cardState.SELECTED_SITE && selectedSite != null"></mds-site-info-card>
      </div>
      <div class="row footer">
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.FOLLOWING" color="primary"
                     class="flex-space-between">
          <div></div>
          <div>
            <button mat-raised-button color="accent" (click)="deactivateFollowMe()">Stop Follow Me</button>
          </div>
          <div></div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.MOVING_MAPPABLE" color="primary"
                     class="flex-space-between">
          <div>
            <button mat-raised-button color="accent" (click)="cancelMove()">Cancel</button>
          </div>
          <div>
            Drag Marker
          </div>
          <div>
            <button mat-raised-button color="accent" (click)="saveMove()">Save</button>
          </div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.MULTI_SELECT" color="primary"
                     class="flex-space-between">
          <div>
            <button mat-raised-button color="warn" (click)="cancelMultiSelect()">Cancel</button>
          </div>
          <div>
            <button mat-mini-fab [mat-menu-trigger-for]="drawingToolsMenu" color="primary">
              <i *ngIf="mapService.drawingModeIs('pointer')" class="far fa-hand-pointer"></i>
              <i *ngIf="mapService.drawingModeIs('circle')" class="far fa-circle"></i>
              <i *ngIf="mapService.drawingModeIs('rectangle')" class="far fa-square"></i>
              <i *ngIf="mapService.drawingModeIs('polygon')" class="far fa-star"></i>
            </button>
          </div>
          <div>
            <button mat-mini-fab [mat-menu-trigger-for]="multiSelectModeMenu" color="primary">
              <i *ngIf="storeMapLayer.selectionMode === storeSelectionMode.MULTI_SELECT" class="fas fa-plus"></i>
              <i *ngIf="storeMapLayer.selectionMode === storeSelectionMode.MULTI_DESELECT" class="fas fa-minus"></i>
            </button>
          </div>
          <div>
            <button mat-raised-button color="accent" [mat-menu-trigger-for]="multiSelectActionMenu">
              Actions
            </button>
          </div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.EDIT_PROJECT_BOUNDARY" color="primary"
                     class="flex-space-between">
          <div>
            <button mat-raised-button (click)="cancelProjectBoundaryEditing()" color="warn">Cancel</button>
          </div>
          <div>
            <button mat-mini-fab [mat-menu-trigger-for]="drawingToolsMenu" color="primary">
              <i *ngIf="mapService.drawingModeIs('pointer')" class="far fa-hand-pointer"></i>
              <i *ngIf="mapService.drawingModeIs('circle')" class="far fa-circle"></i>
              <i *ngIf="mapService.drawingModeIs('rectangle')" class="far fa-square"></i>
              <i *ngIf="mapService.drawingModeIs('polygon')" class="far fa-star"></i>
            </button>
          </div>
          <div>
            <button mat-mini-fab *ngIf="!projectBoundaryService.deletingProjectShapes" color="primary"
                    (click)="projectBoundaryService.enableProjectShapeDeletion()">
              <i class="fas fa-trash-alt"></i>
            </button>
            <button mat-mini-fab *ngIf="projectBoundaryService.deletingProjectShapes" color="accent"
                    (click)="projectBoundaryService.disableProjectShapeDeletion()">
              <i class="fas fa-trash-alt fa-spin"></i>
            </button>
          </div>
          <div>
            <button *ngIf="!savingBoundary" mat-raised-button color="accent" (click)="saveProjectBoundary()">Save
            </button>
            <button *ngIf="savingBoundary" mat-raised-button color="accent" disabled><i
              class="fas fa-spinner fa-pulse"></i></button>
          </div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.CREATING_NEW" color="primary"
                     class="flex-space-between">
          <button mat-raised-button color="warn" (click)="cancelSiteCreation()">Cancel</button>
          <span>Drag Pin</span>
          <button mat-raised-button color="accent" (click)="editNewLocation()">Create</button>
        </mat-toolbar>

        //Duplicate Selection
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.DUPLICATE_SELECTION" color="primary"
                     class="flex-space-between">
          <button mat-raised-button color="warn" (click)="cancelDuplicateSelection()">Cancel</button>
          <div>Select Duplicate</div>
          <div>
            <button type="button" mat-mini-fab color="accent" (click)="merge()"
                    [disabled]="mergeCheck">
              <i *ngIf="!gettingEntities" class="fas fa-download"></i>
              <i *ngIf="gettingEntities" class="fas fa-spinner fa-pulse"></i>Merge
            </button>
          </div>
        </mat-toolbar>

        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.DEFAULT" color="primary"
                     class="flex-space-between">
          <button mat-mini-fab color="primary" [mat-menu-trigger-for]="moreMenu">
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <button mat-mini-fab color="primary" [mat-menu-trigger-for]="searchMenu">
            <i class="fas fa-search"></i>
          </button>
          <button mat-mini-fab color="primary" (click)="filterSideNavIsOpen = !filterSideNavIsOpen">
            <i class="fas fa-filter"></i>
          </button>
          <button disabled mat-mini-fab color="primary" routerLink="site-list">
            <i class="fas fa-list"></i>
          </button>
        </mat-toolbar>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>

<mat-menu #multiSelectActionMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item *ngIf="storeMapLayer.getSelectionCount() > 0" disabled>{{storeMapLayer.getSelectionCount()}}&nbsp;Stores</button>
  <!--<button mat-menu-item disabled><i class="fas fa-thumbtack"></i>&nbsp;&nbsp;Pin</button>-->
  <button mat-menu-item (click)="openDownloadDialog()" *ngIf="!userIsGuest()">
    <i class="fas fa-download"></i>&nbsp;&nbsp;Download Latest Data
  </button>
  <button mat-menu-item (click)="assignSelectedStoresToUser(null)">
    <i class="fas fa-ban"></i>&nbsp;&nbsp;Unassign
  </button>
  <button mat-menu-item (click)="assignToSelf()">
    <i class="fas fa-user-tie"></i>&nbsp;&nbsp;Assign To Me
  </button>
  <button mat-menu-item (click)="openAssignmentDialog()">
    <i class="fas fa-user"></i>&nbsp;&nbsp;Assign
  </button>
</mat-menu>

<mat-menu #markerTypeMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="setMarkerType(markerType.PIN)">{{markerType.PIN.valueOf()}}</button>
  <!--<button mat-menu-item (click)="setMarkerType(markerType.LABEL)">{{markerType.LABEL.valueOf()}}</button>-->
  <button mat-menu-item (click)="setMarkerType(markerType.LOGO)">{{markerType.LOGO.valueOf()}}</button>
  <button mat-menu-item (click)="setMarkerType(markerType.VALIDATION)">{{markerType.VALIDATION.valueOf()}}</button>
  <button mat-menu-item (click)="setMarkerType(markerType.PROJECT_COMPLETION)">{{markerType.PROJECT_COMPLETION.valueOf()}}</button>
</mat-menu>

<mat-menu #drawingToolsMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="mapService.setDrawingModeToClick()">
    <i class="far fa-hand-pointer"></i>&nbsp;Click
  </button>
  <button mat-menu-item (click)="mapService.setDrawingModeToRectangle()">
    <i class="far fa-square"></i>&nbsp;Rectangle
  </button>
  <button mat-menu-item (click)="mapService.setDrawingModeToCircle()">
    <i class="far fa-circle"></i>&nbsp;Circle
  </button>
  <button mat-menu-item (click)="mapService.setDrawingModeToPolygon()">
    <i class="far fa-star"></i>&nbsp;Polygon
  </button>
</mat-menu>

<mat-menu #multiSelectModeMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="storeMapLayer.selectionMode = storeSelectionMode.MULTI_SELECT">
    <i class="fas fa-plus-circle"></i>&nbsp;Select
  </button>
  <button mat-menu-item (click)="storeMapLayer.selectionMode = storeSelectionMode.MULTI_DESELECT">
    <i class="fas fa-minus-circle"></i>&nbsp;Deselect
  </button>
</mat-menu>

<mat-menu #searchMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="openDatabaseSearch()">
    <i class="fas fa-database"></i>&nbsp;Database
  </button>
  <button mat-menu-item (click)="openLatLngSearch()">
    <i class="fas fa-crosshairs"></i>&nbsp;Lat/Lng
  </button>
  <button mat-menu-item (click)="openGoogleSearch()">
    <i class="fab fa-google"></i>&nbsp;Google
  </button>
  <button mat-menu-item (click)="clearGoogleSearch()" *ngIf="googlePlacesLayer != null">
    <i class="fas ban"></i>&nbsp;Clear Google Search
  </button>
</mat-menu>

<mat-menu #moreMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item [mat-menu-trigger-for]="markerTypeMenu">
    <i class="fas fa-map-marker"></i>&nbsp;Marker Type: {{storeMapLayer.markerType.valueOf()}}
  </button>
  <button mat-menu-item (click)="initSiteCreation()">
    <i class="fas fa-plus-circle"></i>&nbsp;Create New Site
  </button>
  <button mat-menu-item (click)="enableMultiSelect()">
    <i class="fas fa-hand-pointer"></i>&nbsp;Enable Multi-select
  </button>
  <button mat-menu-item (click)="openDownloadDialog()" [disabled]="entitySelectionService.storeIds.size < 1"
          *ngIf="!userIsGuest()">
    <i class="fas fa-download"></i>&nbsp;Download Latest ({{entitySelectionService.storeIds.size}})
  </button>
  <button mat-menu-item [mat-menu-trigger-for]="geolocationSubMenu">
    <i class="fas fa-crosshairs"></i>&nbsp;Geolocation
  </button>
  <button mat-menu-item *ngIf="!casingDashboardService.getSelectedProject()"
          (click)="casingDashboardService.openProjectSelectionDialog()">
    <i class="fas fa-folder"></i>&nbsp;Select Project
  </button>
  <button mat-menu-item *ngIf="casingDashboardService.getSelectedProject()"
          [mat-menu-trigger-for]="projectSubMenu">
    {{casingDashboardService.getSelectedProject().projectName}}
  </button>
</mat-menu>

<mat-menu #geolocationSubMenu="matMenu">
  <button mat-menu-item (click)="findMe()">
    <i class="fas fa-crosshairs"></i>&nbsp;Find Me
  </button>
  <button mat-menu-item (click)="activateFollowMe()">
    <i class="fas fa-location-arrow"></i>&nbsp;Follow Me
  </button>
</mat-menu>

<mat-menu #projectSubMenu="matMenu">
  <div *ngIf="casingDashboardService.getSelectedProject()">
    <button mat-menu-item (click)="casingDashboardService.openProjectSelectionDialog()">
      <i class="fas fa-folder"></i>&nbsp;Change Project
    </button>
    <button mat-menu-item
            *ngIf="!casingDashboardService.getSelectedProject().hasBoundary && !projectBoundaryService.isShowingBoundary()"
            (click)="enableProjectBoundaryEditing()">
      Create Boundary
    </button>
    <div *ngIf="casingDashboardService.getSelectedProject().hasBoundary">
      <button mat-menu-item (click)="selectAllInBoundary()">
        Select All In Boundary
      </button>
      <button mat-menu-item (click)="enableProjectBoundaryEditing()">
        Edit Boundary
      </button>
      <button mat-menu-item *ngIf="projectBoundaryService.isShowingBoundary()"
              (click)="projectBoundaryService.hideProjectBoundaries()">
        Hide Boundary
      </button>
      <button mat-menu-item *ngIf="!projectBoundaryService.isShowingBoundary()"
              (click)="showBoundary()">
        Show Boundary
      </button>
    </div>
  </div>
</mat-menu>

<i *ngIf="gettingEntities" id="loadingSpinner" class="fas fa-spinner fa-pulse fa-2x"></i>
