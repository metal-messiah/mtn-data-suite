<mat-sidenav-container id="casing-dash-container">
  <mat-sidenav mode="over" [(opened)]="sideNavIsOpen" class="casing-side-nav">
    <mat-nav-list role="list">
      <h3 mat-subheader>Project</h3>
      <mat-list-item routerLink="/casing/projects">Manage Projects</mat-list-item>
      <mat-list-item *ngIf="casingDashboardService.selectedProject == null"
                     (click)="casingDashboardService.openProjectSelectionDialog()">Select Project
      </mat-list-item>
      <mat-list-item *ngIf="casingDashboardService.selectedProject != null"
                     [matMenuTriggerFor]="selectedProjectMenu">
        {{casingDashboardService.selectedProject.projectName}}&nbsp;<i class="fas fa-chevron-right"></i>
      </mat-list-item>
      <mat-divider></mat-divider>
      <h3 mat-subheader>Sites</h3>
      <mat-list-item role="listitem" [matMenuTriggerFor]="markerTypeMenu">
        <h4 mat-line>Marker Type</h4>&nbsp;<i class="fas fa-chevron-right"></i>
        <p mat-line>{{selectedMarkerType.valueOf()}}</p>
      </mat-list-item>
      <mat-list-item role="listitem" (click)="createNewLocation()">Create New Site</mat-list-item>
      <mat-list-item role="listitem" (click)="multiSelect()">Multi Select</mat-list-item>
      <mat-divider></mat-divider>
      <h3 mat-subheader>Geolocation</h3>
      <mat-list-item role="listitem" (click)="findMe()">Find Me</mat-list-item>
      <mat-list-item *ngIf="selectedDashboardMode === casingDashboardMode.FOLLOWING" role="listitem"
                     (click)="deactivateFollowMe()">
        <h4 mat-line>Follow Me</h4>
        <p mat-line>Deactivate</p>
      </mat-list-item>
      <mat-list-item *ngIf="selectedDashboardMode !== casingDashboardMode.FOLLOWING" role="listitem"
                     (click)="activateFollowMe()">
        <h4 mat-line>Follow Me</h4>
        <p mat-line>Activate</p>
      </mat-list-item>
    </mat-nav-list>
  </mat-sidenav>
  <mat-sidenav-content>
    <form class="box">
      <mds-map #casingMap class="row content" (ready)="onMapReady($event)"></mds-map>
      <div class="infoCard" *ngIf="selectedCardState === cardState.GOOGLE && selectedGooglePlace != null">
        <mat-card>
          <mat-card-header>
            <mat-card-title>
              <strong>{{selectedGooglePlace.name}}</strong>
            </mat-card-title>
            <mat-card-subtitle>Provided by Google</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            {{selectedGooglePlace.vicinity}}
          </mat-card-content>
          <mat-card-actions>
            <button mat-button [disabled]="selectedDashboardMode === casingDashboardMode.MOVING_MAPPABLE"
                    (click)="saveGooglePlaceAsStore()">
              <i class="fas fa-save"></i>&nbsp;Save To DB
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
      <div id="storeInfoCard" class="infoCard" *ngIf="selectedCardState === cardState.SELECTED_MAPPABLE">
        <mat-card>
          <mat-card-header>
            <mat-card-title>
              <strong>{{mappableService.getLatestSelection().getLabel()}}</strong>
            </mat-card-title>
            <mat-card-subtitle *ngIf="mappableService.getLatestSelection().currentStoreStatus != null">
              {{mappableService.getLatestSelection().currentStoreStatus.status}}
            </mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div style="display:flex; justify-content: space-between;">
              <div>
                <p>{{mappableService.getLatestSelection().site.getIntersection()}}</p>
                <p>{{mappableService.getLatestSelection().site.address1}}</p>
                <p>{{mappableService.getLatestSelection().site.getPrincipality()}}</p>
              </div>
            </div>
          </mat-card-content>
          <mat-card-actions>
            <button mat-button [disabled]="selectedDashboardMode === casingDashboardMode.MOVING_MAPPABLE"
                    [matMenuTriggerFor]="markerMoreMenu">
              <i class="fas fa-ellipsis-v"></i>&nbsp;More
            </button>
            <!-- TODO Enable Pinning-->
            <button mat-button [disabled]="true || selectedDashboardMode === casingDashboardMode.MOVING_MAPPABLE"
                    (click)="pinLocation()">
              <i class="fas fa-thumbtack"></i>&nbsp;Pin
            </button>
            <button mat-button [disabled]="selectedDashboardMode === casingDashboardMode.MOVING_MAPPABLE"
                    (click)="goToSiteOverview()">
              <i class="fas fa-pencil-alt"></i>&nbsp;Edit
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
      <div class="row footer">
        <!--<div *ngIf="page != null">Showing {{page.numberOfElements}} of {{page.totalElements}}</div>-->
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.FOLLOWING"
                     class="flex-space-between"
                     color="primary">
          <div></div>
          <div>
            <button mat-raised-button color="accent" (click)="deactivateFollowMe()">Stop Follow Me</button>
          </div>
          <div></div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.MOVING_MAPPABLE"
                     class="flex-space-between" color="primary">
          <div>
            <button mat-raised-button color="accent" (click)="cancelStoreMove()">Cancel</button>
          </div>
          <div>
            Drag Marker
          </div>
          <div>
            <button mat-raised-button color="accent" (click)="saveStoreMove()">Save</button>
          </div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.MULTI_SELECT"
                     class="flex-space-between" color="primary">
          <div>
            <button mat-raised-button color="warn" (click)="cancelMultiSelect()">Cancel</button>
          </div>
          <div>
            <button mat-mini-fab [mat-menu-trigger-for]="multiSelectToolsMenu" color="primary">
              <i *ngIf="selectedMultiSelectTool === multiSelectToolType.CLICK" class="far fa-hand-pointer"></i>
              <i *ngIf="selectedMultiSelectTool === multiSelectToolType.CIRCLE" class="far fa-circle"></i>
              <i *ngIf="selectedMultiSelectTool === multiSelectToolType.RECTANGLE" class="far fa-square"></i>
              <i *ngIf="selectedMultiSelectTool === multiSelectToolType.POLYGON" class="far fa-star"></i>
            </button>
          </div>
          <div>
            <button mat-mini-fab [mat-menu-trigger-for]="multiSelectModeMenu" color="primary">
              <i *ngIf="selectedMultiSelectMode === multiSelectMode.SELECT" class="fas fa-plus"></i>
              <i *ngIf="selectedMultiSelectMode === multiSelectMode.DESELECT" class="fas fa-minus"></i>
            </button>
          </div>
          <div>
            <button mat-raised-button color="accent" [mat-menu-trigger-for]="multiSelectActionMenu">
              <span *ngIf="mappableService.numSelected > 0">({{mappableService.numSelected}})</span>&nbsp;Actions
            </button>
            <mat-menu #multiSelectActionMenu="matMenu" [overlapTrigger]="false">
              <button mat-menu-item>Pin</button>
              <button mat-menu-item>Assign</button>
            </mat-menu>
          </div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.CREATING_NEW"
                     class="flex-space-between" color="primary">
          <div>
            <button mat-raised-button color="warn" (click)="cancelLocationCreation()">Cancel</button>
          </div>
          <div>
            <span>Drag Pin</span>
          </div>
          <div>
            <button mat-raised-button color="accent" (click)="editNewLocation()">Edit Details</button>
          </div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.DEFAULT" class="flex-space-between"
                     color="primary">
          <div>
            <button mat-mini-fab color="primary" (click)="sideNavIsOpen = !sideNavIsOpen">
              <i class="fas fa-ellipsis-v"></i>
            </button>
          </div>
          <div>
            <button mat-mini-fab color="primary" [matMenuTriggerFor]="searchMenu">
              <i class="fas fa-search"></i>
            </button>
          </div>
          <div>
            <button mat-mini-fab color="primary" disabled="true">
              <i class="fas fa-filter"></i>
            </button>
          </div>
          <div>
            <button mat-mini-fab color="primary" routerLink="site-list">
              <i class="fas fa-list"></i>
            </button>
          </div>
        </mat-toolbar>
      </div>
    </form>
  </mat-sidenav-content>
</mat-sidenav-container>

<mat-menu #selectedProjectMenu="matMenu" [overlapTrigger]="false" xPosition="after">
  <button mat-menu-item (click)="casingDashboardService.openProjectSelectionDialog()">Change Selected Project</button>
  <button mat-menu-item (click)="casingDashboardService.navigateToProjectSummary()">View Summary</button>
  <button mat-menu-item (click)="casingDashboardService.navigateToProjectDetail()">Edit</button>
  <button mat-menu-item *ngIf="!showingBoundaries"
          (click)="toggleSelectedProjectBoundaries(true)">Show Boundaries
  </button>
  <button mat-menu-item *ngIf="showingBoundaries"
          (click)="toggleSelectedProjectBoundaries(false)">Hide Boundaries
  </button>
</mat-menu>

<mat-menu #markerTypeMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="setMarkerType(markerType.PIN)">{{markerType.PIN.valueOf()}}</button>
  <button mat-menu-item (click)="setMarkerType(markerType.LABEL)">{{markerType.LABEL.valueOf()}}</button>
  <button mat-menu-item (click)="setMarkerType(markerType.LOGO)">{{markerType.LOGO.valueOf()}}</button>
</mat-menu>

<mat-menu #markerMoreMenu="matMenu" [overlapTrigger]="false">
  <div *ngIf="mappableService.getLatestSelection() != null" mat-menu-item>Store ID:
    #{{mappableService.getLatestSelection().id}}
  </div>
  <button mat-menu-item (click)="moveStore()"><i class="fas fa-arrows-alt"></i>&nbsp;Move</button>
  <button mat-menu-item disabled="true"><i class="far fa-clock"></i>&nbsp;History</button>
  <button mat-menu-item (click)="flagAsDuplicate()" *ngIf="mappableService.getLatestSelection() != null && !mappableService.getLatestSelection().site.duplicate"><i class="fas fa-flag"></i>&nbsp;Flag as Duplicate</button>
  <button mat-menu-item (click)="unflagAsDuplicate()" *ngIf="mappableService.getLatestSelection() != null && mappableService.getLatestSelection().site.duplicate"><i class="fas fa-flag"></i>&nbsp;Unflag as Duplicate</button>
  <button mat-menu-item><i class="fas fa-user"></i>&nbsp;Assign to Analyst</button>
</mat-menu>

<mat-menu #multiSelectToolsMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="setMultiSelectTool(multiSelectToolType.CLICK)">
    <i class="far fa-hand-pointer"></i>&nbsp;Click
  </button>
  <button mat-menu-item (click)="setMultiSelectTool(multiSelectToolType.RECTANGLE)">
    <i class="far fa-square"></i>&nbsp;Rectangle
  </button>
  <button mat-menu-item (click)="setMultiSelectTool(multiSelectToolType.CIRCLE)">
    <i class="far fa-circle"></i>&nbsp;Circle
  </button>
  <button mat-menu-item (click)="setMultiSelectTool(multiSelectToolType.POLYGON)">
    <i class="far fa-star"></i>&nbsp;Polygon
  </button>
</mat-menu>

<mat-menu #multiSelectModeMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="setMultiSelectMode(multiSelectMode.SELECT)">
    <i class="fas fa-plus-circle"></i>&nbsp;Select
  </button>
  <button mat-menu-item (click)="setMultiSelectMode(multiSelectMode.DESELECT)">
    <i class="fas fa-minus-circle"></i>&nbsp;Deselect
  </button>
</mat-menu>

<mat-menu #searchMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="openDatabaseSearch()">
    <i class="fas fa-database"></i>&nbsp;Database
  </button>
  <button mat-menu-item (click)="openLatLngSearch()">
    <i class="fas fa-crosshairs"></i>&nbsp;Lat/Lng
  </button>
  <button mat-menu-item (click)="openGoogleSearch()">
    <i class="fab fa-google"></i>&nbsp;Google
  </button>
  <button mat-menu-item (click)="clearGoogleSearch()" *ngIf="googleLayer != null">
    <i class="fas ban"></i>&nbsp;Clear Google Search
  </button>
</mat-menu>
