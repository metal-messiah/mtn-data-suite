<mat-sidenav-container id="casing-dash-container">
  <mat-sidenav mode="over" [(opened)]="filterSideNavIsOpen" class="casing-side-nav" position="end"
               (closedStart)="filterClosed()">
    <mat-list role="list" id="filter-side-nav" [formGroup]="dbEntityMarkerService.controls">
      <h3 mat-subheader>Filters</h3>
      <div class="checklist">
        <mat-checkbox formControlName="showActive">Active</mat-checkbox>
        <mat-checkbox formControlName="showFuture">Future</mat-checkbox>
        <mat-checkbox formControlName="showHistorical">Historical</mat-checkbox>
        <mat-checkbox formControlName="showEmptySites">Empty Sites</mat-checkbox>
        <mat-checkbox formControlName="showSitesBackfilledByNonGrocery">Backfilled Sites</mat-checkbox>
        <mat-checkbox formControlName="showFloat">Float Stores</mat-checkbox>
      </div>
      <mat-divider></mat-divider>

      <h3 mat-subheader>Marker Type</h3>
      <mat-form-field id="marker-type-selector" floatLabel="never">
        <mat-select formControlName="markerType">
          <mat-option *ngFor="let markerType of dbEntityMarkerService.markerTypeOptions" [value]="markerType">
            {{markerType}}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-divider></mat-divider>

      <h3 mat-subheader>Controls</h3>
      <div>
        <div class="checklist">
          <mat-checkbox formControlName="cluster">Cluster Stores</mat-checkbox>
        </div>
        <div *ngIf="dbEntityMarkerService.controls.get('cluster').value">
          <h3 mat-subheader>Cluster when zoom <= {{dbEntityMarkerService.controls.get('clusterZoomLevel').value}}</h3>
          <mat-slider [max]="21" [min]="0" [thumbLabel]="true" formControlName="clusterZoomLevel"></mat-slider>
        </div>
        <mat-divider></mat-divider>
        <div>
          <h3 mat-subheader>Pull when zoom >= {{dbEntityMarkerService.controls.get('minPullZoomLevel').value}}</h3>
          <mat-slider [max]="21" [min]="0" [thumbLabel]="true" formControlName="minPullZoomLevel"></mat-slider>
        </div>
        <mat-divider></mat-divider>
        <div>
          <h3 mat-subheader>Full Label when zoom >= {{dbEntityMarkerService.controls.get('fullLabelMinZoomLevel').value}}</h3>
          <mat-slider [max]="21" [min]="0" [thumbLabel]="true" formControlName="fullLabelMinZoomLevel"></mat-slider>
        </div>
        <mat-divider></mat-divider>
        <h3 mat-subheader>(Current Zoom: {{mapService.getZoom()}})</h3>
      </div>
    </mat-list>
  </mat-sidenav>
  <mat-sidenav-content>
    <div class="box">
      <mds-map #casingMap class="row content" (ready)="onMapReady()"></mds-map>
      <mds-info-card *ngIf="infoCard" class="infoCardContainer"
                     [infoCard]="infoCard" [disabled]="selectedDashboardMode !== casingDashboardMode.DEFAULT">
      </mds-info-card>
      <div class="row footer">
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.FOLLOWING" color="primary"
                     class="flex-space-between">
          <div></div>
          <div>
            <button mat-raised-button color="accent" (click)="deactivateFollowMe()">Stop Follow Me</button>
          </div>
          <div></div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.MOVING_MAPPABLE" color="primary"
                     class="flex-space-between">
          <div>
            <button mat-raised-button color="accent" (click)="cancelMove()">Cancel</button>
          </div>
          <div>
            Drag Marker
          </div>
          <div>
            <button mat-raised-button color="accent" (click)="saveMove()">Save</button>
          </div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.MULTI_SELECT" color="primary"
                     class="flex-space-between">
          <div>
            <button mat-raised-button color="warn" (click)="cancelMultiSelect()">Cancel</button>
          </div>
          <div>
            <button mat-mini-fab [mat-menu-trigger-for]="drawingToolsMenu" color="primary">
              <i *ngIf="mapService.drawingModeIs('pointer')" class="far fa-hand-pointer"></i>
              <i *ngIf="mapService.drawingModeIs('circle')" class="far fa-circle"></i>
              <i *ngIf="mapService.drawingModeIs('rectangle')" class="far fa-square"></i>
              <i *ngIf="mapService.drawingModeIs('polygon')" class="far fa-star"></i>
            </button>
          </div>
          <div>
            <button mat-mini-fab [mat-menu-trigger-for]="multiSelectModeMenu" color="primary">
              <i *ngIf="!dbEntityMarkerService.controls.get('multiDeselect').value" class="fas fa-plus"></i>
              <i *ngIf="dbEntityMarkerService.controls.get('multiDeselect').value" class="fas fa-minus"></i>
            </button>
          </div>
          <div>
            <button mat-raised-button color="accent" [mat-menu-trigger-for]="multiSelectActionMenu">
              Actions
            </button>
          </div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.EDIT_PROJECT_BOUNDARY" color="primary"
                     class="flex-space-between">
          <div>
            <button mat-raised-button (click)="cancelProjectBoundaryEditing()" color="warn">Cancel</button>
          </div>
          <div>
            <button mat-mini-fab [mat-menu-trigger-for]="drawingToolsMenu" color="primary">
              <i *ngIf="mapService.drawingModeIs('pointer')" class="far fa-hand-pointer"></i>
              <i *ngIf="mapService.drawingModeIs('circle')" class="far fa-circle"></i>
              <i *ngIf="mapService.drawingModeIs('rectangle')" class="far fa-square"></i>
              <i *ngIf="mapService.drawingModeIs('polygon')" class="far fa-star"></i>
            </button>
          </div>
          <div>
            <button mat-mini-fab *ngIf="!projectBoundaryService.deletingProjectShapes" color="primary"
                    (click)="projectBoundaryService.enableProjectShapeDeletion()">
              <i class="fas fa-trash-alt"></i>
            </button>
            <button mat-mini-fab *ngIf="projectBoundaryService.deletingProjectShapes" color="accent"
                    (click)="projectBoundaryService.disableProjectShapeDeletion()">
              <i class="fas fa-trash-alt fa-spin"></i>
            </button>
          </div>
          <div>
            <button *ngIf="!savingBoundary" mat-raised-button color="accent" (click)="saveProjectBoundary()">Save
            </button>
            <button *ngIf="savingBoundary" mat-raised-button color="accent" disabled><i
              class="fas fa-spinner fa-pulse"></i></button>
          </div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.CREATING_NEW" color="primary"
                     class="flex-space-between">
          <button mat-raised-button color="warn" (click)="cancelSiteCreation()">Cancel</button>
          <span>Drag Pin</span>
          <button mat-raised-button color="accent" (click)="editNewLocation()">Create</button>
        </mat-toolbar>

        <!--Duplicate Selection-->
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.DUPLICATE_SELECTION" color="primary"
                     class="flex-space-between">
        </mat-toolbar>

        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.DEFAULT" color="primary"
                     class="flex-space-between">
          <button mat-mini-fab color="primary" [mat-menu-trigger-for]="moreMenu">
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <button mat-mini-fab color="primary" [mat-menu-trigger-for]="searchMenu">
            <i class="fas fa-search"></i>
          </button>
          <button mat-mini-fab color="primary" (click)="filterSideNavIsOpen = !filterSideNavIsOpen">
            <i class="fas fa-sliders-h"></i>
          </button>
        </mat-toolbar>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>

<mat-menu #multiSelectActionMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item *ngIf="dbEntityMarkerService.getSelectedStoreIds().length > 0" disabled>
    {{dbEntityMarkerService.getSelectedStoreIds().length}}&nbsp;Stores
  </button>
  <button mat-menu-item (click)="openDownloadDialog()" *ngIf="!userIsGuest()">
    <i class="fas fa-download"></i>&nbsp;&nbsp;Download Latest Data
  </button>
  <button mat-menu-item (click)="assignSelectedStoresToUser(null)">
    <i class="fas fa-ban"></i>&nbsp;&nbsp;Unassign
  </button>
  <button mat-menu-item (click)="assignToSelf()">
    <i class="fas fa-user-tie"></i>&nbsp;&nbsp;Assign To Me
  </button>
  <button mat-menu-item (click)="openAssignmentDialog()">
    <i class="fas fa-user"></i>&nbsp;&nbsp;Assign
  </button>
</mat-menu>

<mat-menu #drawingToolsMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="mapService.setDrawingModeToClick()">
    <i class="far fa-hand-pointer"></i>&nbsp;Click
  </button>
  <button mat-menu-item (click)="mapService.setDrawingModeToRectangle()">
    <i class="far fa-square"></i>&nbsp;Rectangle
  </button>
  <button mat-menu-item (click)="mapService.setDrawingModeToCircle()">
    <i class="far fa-circle"></i>&nbsp;Circle
  </button>
  <button mat-menu-item (click)="mapService.setDrawingModeToPolygon()">
    <i class="far fa-star"></i>&nbsp;Polygon
  </button>
</mat-menu>

<mat-menu #multiSelectModeMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="storeMapLayer.selectionMode = storeSelectionMode.MULTI_SELECT">
    <i class="fas fa-plus-circle"></i>&nbsp;Select
  </button>
  <button mat-menu-item (click)="storeMapLayer.selectionMode = storeSelectionMode.MULTI_DESELECT">
    <i class="fas fa-minus-circle"></i>&nbsp;Deselect
  </button>
</mat-menu>

<mat-menu #searchMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="openDatabaseSearch()">
    <i class="fas fa-database"></i>&nbsp;Database
  </button>
  <button mat-menu-item (click)="openLatLngSearch()">
    <i class="fas fa-crosshairs"></i>&nbsp;Lat/Lng
  </button>
  <button mat-menu-item (click)="openGoogleSearch()">
    <i class="fab fa-google"></i>&nbsp;Google
  </button>
  <button mat-menu-item (click)="clearGoogleSearch()" *ngIf="googlePlacesLayer != null">
    <i class="fas ban"></i>&nbsp;Clear Google Search
  </button>
</mat-menu>

<mat-menu #moreMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="initSiteCreation()">
    <i class="fas fa-plus-circle"></i>&nbsp;Create New Site
  </button>
  <button mat-menu-item (click)="enableMultiSelect()">
    <i class="fas fa-hand-pointer"></i>&nbsp;Enable Multi-select
  </button>
  <button mat-menu-item (click)="openDownloadDialog()" [disabled]="entitySelectionService.storeIds.size < 1"
          *ngIf="!userIsGuest()">
    <i class="fas fa-download"></i>&nbsp;Download Latest ({{entitySelectionService.storeIds.size}})
  </button>
  <button mat-menu-item [mat-menu-trigger-for]="geolocationSubMenu">
    <i class="fas fa-crosshairs"></i>&nbsp;Geolocation
  </button>
  <button mat-menu-item *ngIf="!casingDashboardService.getSelectedProject()"
          (click)="casingDashboardService.openProjectSelectionDialog()">
    <i class="fas fa-folder"></i>&nbsp;Select Project
  </button>
  <button mat-menu-item *ngIf="casingDashboardService.getSelectedProject()"
          [mat-menu-trigger-for]="projectSubMenu">
    {{casingDashboardService.getSelectedProject().projectName}}
  </button>
</mat-menu>

<mat-menu #geolocationSubMenu="matMenu">
  <button mat-menu-item (click)="findMe()">
    <i class="fas fa-crosshairs"></i>&nbsp;Find Me
  </button>
  <button mat-menu-item (click)="activateFollowMe()">
    <i class="fas fa-location-arrow"></i>&nbsp;Follow Me
  </button>
</mat-menu>

<mat-menu #projectSubMenu="matMenu">
  <div *ngIf="casingDashboardService.getSelectedProject()">
    <button mat-menu-item (click)="casingDashboardService.openProjectSelectionDialog()">
      <i class="fas fa-folder"></i>&nbsp;Change Project
    </button>
    <button mat-menu-item
            *ngIf="!casingDashboardService.getSelectedProject().hasBoundary && !projectBoundaryService.isShowingBoundary()"
            (click)="enableProjectBoundaryEditing()">
      Create Boundary
    </button>
    <div *ngIf="casingDashboardService.getSelectedProject().hasBoundary">
      <button mat-menu-item (click)="selectAllInBoundary()">
        Select All In Boundary
      </button>
      <button mat-menu-item (click)="enableProjectBoundaryEditing()">
        Edit Boundary
      </button>
      <button mat-menu-item *ngIf="projectBoundaryService.isShowingBoundary()"
              (click)="projectBoundaryService.hideProjectBoundaries()">
        Hide Boundary
      </button>
      <button mat-menu-item *ngIf="!projectBoundaryService.isShowingBoundary()"
              (click)="showBoundary()">
        Show Boundary
      </button>
    </div>
  </div>
</mat-menu>

<i *ngIf="dbEntityMarkerService.gettingLocations" id="loadingSpinner" class="fas fa-spinner fa-pulse fa-2x"></i>
