<mat-sidenav-container id="casing-dash-container">
  <mat-sidenav mode="over" [(opened)]="filterSideNavIsOpen" class="casing-side-nav" position="end"
               (closedStart)="controlSideMenuClosed()">
    <mds-db-entity-controls (viewStoreList)="openSidenavDirectlyToSelectedListStores($event)"
                            (apply)="filterSideNavIsOpen = false"></mds-db-entity-controls>
  </mat-sidenav>
  <mat-sidenav-content>
    <div class="box">
      <div class="center-content">
        <mds-store-sidenav id="store-sidenav" [expanded]="showStoreLists"
                           [ngClass]="{'sidenav-hide': !showStoreLists, 'sidenav-show':showStoreLists, 'adjusted-height': (infoCard && isTooNarrow && showStoreLists), 'highlighted': highlightTab}"
                           (click)="handleSidenavClick($event)">
        </mds-store-sidenav>
        <mds-map #casingMap class="row content" (ready)="onMapReady()"></mds-map>
      </div>
      <mds-info-card id="infoCardElement" *ngIf="infoCard"
                     [ngClass]="{'infoCardContainer':true, 'right': showStoreLists}" [infoCard]="infoCard"
                     [disabled]="selectedDashboardMode !== casingDashboardMode.DEFAULT">
      </mds-info-card>
      <div class="row footer">
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.FOLLOWING" color="primary"
                     class="flex-space-between">
          <div></div>
          <div>
            <button mat-raised-button color="accent" (click)="deactivateFollowMe()">Stop Follow Me</button>
          </div>
          <div></div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.MOVING_MAPPABLE" color="primary"
                     class="flex-space-between">
          <div>
            <button mat-raised-button color="accent" (click)="cancelMove()">Cancel</button>
          </div>
          <div>
            Drag Marker
          </div>
          <div>
            <button mat-raised-button color="accent" (click)="saveMove()">Save</button>
          </div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.MULTI_SELECT" color="primary"
                     class="flex-space-between">
          <div>
            <button mat-raised-button color="warn" (click)="cancelMultiSelect()">Cancel</button>
          </div>
          <div>
            <button mat-mini-fab [mat-menu-trigger-for]="drawingToolsMenu" color="primary">
              <i *ngIf="drawingModeIs('pointer')" class="far fa-hand-pointer"></i>
              <i *ngIf="drawingModeIs('circle')" class="far fa-circle"></i>
              <i *ngIf="drawingModeIs('rectangle')" class="far fa-square"></i>
              <i *ngIf="drawingModeIs('polygon')" class="far fa-star"></i>
            </button>
          </div>
          <div>
            <button mat-mini-fab [mat-menu-trigger-for]="multiSelectModeMenu" color="primary">
              <i *ngIf="!deselecting" class="fas fa-plus"></i>
              <i *ngIf="deselecting" class="fas fa-minus"></i>
            </button>
          </div>
          <div>
            <button mat-raised-button color="accent" [mat-menu-trigger-for]="multiSelectActionMenu">
              Actions
            </button>
          </div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.EDIT_PROJECT_BOUNDARY" color="primary"
                     class="flex-space-between">
          <div>
            <button mat-raised-button (click)="cancelProjectBoundaryEditing()" color="warn">Cancel</button>
          </div>
          <div>
            <button mat-mini-fab [mat-menu-trigger-for]="drawingToolsMenu" color="primary">
              <i *ngIf="drawingModeIs('pointer')" class="far fa-hand-pointer"></i>
              <i *ngIf="drawingModeIs('circle')" class="far fa-circle"></i>
              <i *ngIf="drawingModeIs('rectangle')" class="far fa-square"></i>
              <i *ngIf="drawingModeIs('polygon')" class="far fa-star"></i>
            </button>
          </div>
          <div>
            <button mat-mini-fab *ngIf="!deletingProjectShapes" color="primary"
                    (click)="enableProjectShapeDeletion()">
              <i class="fas fa-trash-alt"></i>
            </button>
            <button mat-mini-fab *ngIf="deletingProjectShapes" color="accent"
                    (click)="disableProjectShapeDeletion()">
              <i class="fas fa-trash-alt fa-spin"></i>
            </button>
          </div>
          <div>
            <button *ngIf="!savingBoundary" mat-raised-button color="accent" (click)="saveProjectBoundary()">Save
            </button>
            <button *ngIf="savingBoundary" mat-raised-button color="accent" disabled><i
              class="fas fa-spinner fa-pulse"></i></button>
          </div>
        </mat-toolbar>
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.CREATING_NEW" color="primary"
                     class="flex-space-between">
          <button mat-raised-button color="warn" (click)="cancelSiteCreation()">Cancel</button>
          <span>Drag Pin</span>
          <button mat-raised-button color="accent" (click)="editNewLocation()">Create</button>
        </mat-toolbar>

        <!--Duplicate Selection-->
        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.DUPLICATE_SELECTION" color="primary"
                     class="flex-space-between">
        </mat-toolbar>

        <mat-toolbar *ngIf="selectedDashboardMode === casingDashboardMode.DEFAULT" color="primary"
                     class="flex-space-between">
          <button mat-mini-fab color="primary" [mat-menu-trigger-for]="moreMenu">
            <i class="fas fa-ellipsis-v"></i>
          </button>
          <button mat-mini-fab color="primary" [mat-menu-trigger-for]="searchMenu">
            <i class="fas fa-search"></i>
          </button>
          <button mat-mini-fab color="primary" (click)="filterSideNavIsOpen = !filterSideNavIsOpen">
            <i class="fas fa-sliders-h"></i>
          </button>
        </mat-toolbar>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>

<mat-menu #multiSelectActionMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item *ngIf="selectedStoreIds.size > 0" disabled>
    {{selectedStoreIds.size}}&nbsp;Stores
  </button>
  <button mat-menu-item (click)="openDownloadDialog()" *ngIf="!userIsGuest()">
    <i class="fas fa-download"></i>&nbsp;&nbsp;Download Latest Data
  </button>
  <button mat-menu-item (click)="assignSelectedStoresToUser(null)">
    <i class="fas fa-ban"></i>&nbsp;&nbsp;Unassign
  </button>
  <button mat-menu-item (click)="assignToSelf()">
    <i class="fas fa-user-tie"></i>&nbsp;&nbsp;Assign To Me
  </button>
  <button mat-menu-item (click)="openAssignmentDialog()">
    <i class="fas fa-user"></i>&nbsp;&nbsp;Assign
  </button>
  <button mat-menu-item (click)="addToList()">
    <i class="fas fa-plus-circle"></i>&nbsp;&nbsp;Add to List
  </button>
  <button mat-menu-item (click)="removeFromList()">
    <i class="fas fa-minus-circle"></i>&nbsp;&nbsp;Remove From List
  </button>
</mat-menu>

<mat-menu #drawingToolsMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="setDrawingModeToClick()">
    <i class="far fa-hand-pointer"></i>&nbsp;Click
  </button>
  <button mat-menu-item (click)="setDrawingModeToRectangle()">
    <i class="far fa-square"></i>&nbsp;Rectangle
  </button>
  <button mat-menu-item (click)="setDrawingModeToCircle()">
    <i class="far fa-circle"></i>&nbsp;Circle
  </button>
  <button mat-menu-item (click)="setDrawingModeToPolygon()">
    <i class="far fa-star"></i>&nbsp;Polygon
  </button>
</mat-menu>

<mat-menu #multiSelectModeMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="deselecting = false">
    <i class="fas fa-plus-circle"></i>&nbsp;Select
  </button>
  <button mat-menu-item (click)="deselecting = true">
    <i class="fas fa-minus-circle"></i>&nbsp;Deselect
  </button>
</mat-menu>

<mat-menu #searchMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="openDatabaseSearch()">
    <i class="fas fa-database"></i>&nbsp;Database
  </button>
  <button mat-menu-item (click)="openLatLngSearch()">
    <i class="fas fa-crosshairs"></i>&nbsp;Lat/Lng
  </button>
  <button mat-menu-item (click)="openGoogleSearch()">
    <i class="fab fa-google"></i>&nbsp;Google
  </button>
  <button mat-menu-item (click)="clearGoogleSearch()" *ngIf="googlePlacesLayer != null">
    <i class="fas ban"></i>&nbsp;Clear Google Search
  </button>
</mat-menu>

<mat-menu #moreMenu="matMenu" [overlapTrigger]="false">
  <button mat-menu-item (click)="initSiteCreation()">
    <i class="fas fa-plus-circle"></i>&nbsp;Create New Site
  </button>
  <button mat-menu-item (click)="enableMultiSelect()">
    <i class="fas fa-hand-pointer"></i>&nbsp;Enable Multi-select
  </button>
  <button mat-menu-item (click)="openDownloadDialog()" [disabled]="selectedStoreIds.size < 1"
          *ngIf="!userIsGuest()">
    <i class="fas fa-download"></i>&nbsp;Download Latest ({{selectedStoreIds.size}})
  </button>
  <button mat-menu-item [mat-menu-trigger-for]="geolocationSubMenu">
    <i class="fas fa-crosshairs"></i>&nbsp;Geolocation
  </button>
  <button mat-menu-item *ngIf="!getSelectedProject()"
          (click)="openProjectSelectionDialog()">
    <i class="fas fa-folder"></i>&nbsp;Select Project
  </button>
  <button mat-menu-item *ngIf="getSelectedProject()" [mat-menu-trigger-for]="projectSubMenu">
    {{getSelectedProject().projectName}}
  </button>
</mat-menu>

<mat-menu #geolocationSubMenu="matMenu">
  <button mat-menu-item (click)="findMe()">
    <i class="fas fa-crosshairs"></i>&nbsp;Find Me
  </button>
  <button mat-menu-item (click)="activateFollowMe()">
    <i class="fas fa-location-arrow"></i>&nbsp;Follow Me
  </button>
</mat-menu>

<mat-menu #projectSubMenu="matMenu">
  <div *ngIf="getSelectedProject()">
    <button mat-menu-item (click)="openProjectSelectionDialog()">
      <i class="fas fa-folder"></i>&nbsp;Change Project
    </button>
    <button mat-menu-item
            *ngIf="!getSelectedProject().hasBoundary && !isShowingBoundary()"
            (click)="enableProjectBoundaryEditing()">
      Create Boundary
    </button>
    <div *ngIf="getSelectedProject().hasBoundary">
      <button mat-menu-item (click)="selectAllInBoundary()">
        Select All In Boundary
      </button>
      <button mat-menu-item (click)="enableProjectBoundaryEditing()">
        Edit Boundary
      </button>
      <button mat-menu-item *ngIf="isShowingBoundary()"
              (click)="hideProjectBoundaries()">
        Hide Boundary
      </button>
      <button mat-menu-item *ngIf="!isShowingBoundary()" (click)="showBoundary()">
        Show Boundary
      </button>
    </div>
  </div>
</mat-menu>

<i title="Map is Loading" *ngIf="gettingLocations && !filterSideNavIsOpen" id="loadingSpinner"
   class="fas fa-spinner fa-pulse fa-2x"></i>
<button *ngIf="!controls.updateOnBoundsChange &&
               !gettingLocations && !filterSideNavIsOpen" mat-raised-button id="refresh"
        (click)="getEntitiesInBounds()" color="primary">
  <i class="fas fa-sync"></i>
</button>
